# MathPad 📐

> **「为中学数学教师打造的几何绘图工具」**

[![Version](https://img.shields.io/badge/version-1.0.65-blue.svg)](https://github.com/mathpad)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

MathPad 是一款专为**中国中学数学教师**打造的轻量级平面几何绘图工具，完全覆盖初中（人教版/北师大版）和高中（新课标）的平面几何教学需求。帮助教师在 **3 分钟**内完成一道几何大题的配图。

🔗 **在线体验**: [https://math.qadmlee.com](https://math.qadmlee.com)

---

## ✨ 核心特性

| 特性 | 说明 |
|-----|------|
| 🎯 **几何吸附** | 智能识别交点、中点、垂足、原点等几何位置自动吸附 |
| 📝 **试卷级标注** | 内置国标数学符号（全等≌、相似∽、平行∥、垂直⊥） |
| 🖨️ **印刷友好** | 默认黑白高对比度样式，完美适配黑白试卷打印 |
| 📚 **课标覆盖** | 完整支持初高中平面几何 + 解析几何知识点 |
| ↩️ **撤销/重做** | 50 步历史记录，支持 Ctrl+Z / Ctrl+Y |
| 💾 **自动保存** | localStorage 自动持久化，刷新不丢失 |
| 🌙 **深色模式** | 支持深浅主题切换，网格和坐标轴自动适配 |

---

## 🛠️ 功能模块

### 基础绘图
- **点** - 智能吸附（交点 > 中点 > 原点 > 端点 > 线上点 > 圆上点）
- **线段 / 射线 / 直线 / 辅助线 / 向量** - 支持实线、虚线样式
- **圆 / 弧** - 圆心+半径定义
- **三角形 / 矩形** - 多种预设模板

### 圆锥曲线（解析几何）
- **椭圆** - 焦点模式、中心+轴长模式、标准方程模式
- **抛物线** - 一般方程、顶点+焦点、焦点+准线
- **双曲线** - 标准方程形式
- **函数图像** - 支持 sin/cos/tan/log/exp/sqrt 等函数

### 智能构造
- **垂线 / 平行线** - 选择线和点自动构造
- **切线** - 选择圆和切点
- **中点** - 点击线段获取
- **三角形内心 + 内切圆**
- **三角形外心 + 外接圆**
- **全等三角形** - 选择三角形后旋转/翻转复制
- **相似三角形** - 支持缩放比例调整

### 标注系统
- 顶点自动命名（A, B, C...）
- 角度测量与显示
- 边长关系标记（| || ||| 表示相等边）
- 文字注释

### 视图控制
- 🌙 深色 / 浅色主题切换
- 📐 网格 / 坐标轴 显示控制
- 🔍 缩放与平移（支持底部快捷工具栏）
- 👁️ 隐藏元素管理

### 导出功能
- PNG 导出（3x 高清）
- SVG 矢量导出
- JSON 工程文件导入/导出

---

## ⌨️ 快捷键

| 快捷键 | 功能 |
|-------|------|
| `V` | 选择工具 |
| `P` | 点工具 |
| `L` | 线段工具 |
| `C` | 圆工具 |
| `T` | 三角形工具 |
| `R` | 矩形工具 |
| `Delete` | 删除选中元素 |
| `Escape` | 取消当前操作 |
| `Ctrl+Z` | 撤销 |
| `Ctrl+Y` | 重做 |
| `Alt` (按住) | 禁用吸附 |

---

## 🖥️ 界面布局

```
┌──────────────────────────────────────────────────────────────────┐
│  视图面板 (导出/撤销/重做/主题/清空)                              │
├──────┬─────────────────────────────────────────────────────┬─────┤
│ 工   │                                                     │ 元  │
│ 具   │                                                     │ 素  │
│ 栏   │              画布 (Canvas)                          │ 列  │
│      │                                                     │ 表  │
├──────┤         智能吸附 + 实时预览                          │     │
│ 选项 │                                                     │ 属  │
│ 面板 │                                                     │ 性  │
│      │                                                     │ 面  │
│      │                                                     │ 板  │
├──────┴─────────────────────────────────────────────────────┴─────┤
│              快捷工具栏 (上/下/左/右/放大/缩小/复原/点/选择)       │
├──────────────────────────────────────────────────────────────────┤
│              状态栏 (当前工具 + 操作提示 + 鼠标坐标)              │
└──────────────────────────────────────────────────────────────────┘
```

---

## 🚀 快速开始

### 安装依赖

```bash
npm install
```

### 开发模式

```bash
npm run dev
```

### 构建生产版本

```bash
npm run build
```

### 预览生产版本

```bash
npm run preview
```

---

## 🏗️ 技术栈

| 层级 | 技术 |
|-----|------|
| **框架** | React 19 + TypeScript |
| **渲染引擎** | Konva.js (Canvas 2D) |
| **几何计算** | mathjs |
| **状态管理** | Zustand + zundo (undo/redo) |
| **样式** | Tailwind CSS 4 |
| **构建** | Vite |

---

## 📁 项目结构

```
src/
├── components/              # UI 组件
│   ├── CanvasStage.tsx          # 主画布 (35KB)
│   ├── Toolbar.tsx              # 左侧工具栏
│   ├── RightSidebar.tsx         # 右侧元素列表
│   ├── FloatingPropertyPanel.tsx # 浮动属性面板
│   ├── ConicPanel.tsx           # 圆锥曲线面板 (47KB)
│   ├── TriangleTransformPanel.tsx # 全等/相似三角形面板
│   ├── QuickToolbar.tsx         # 底部快捷工具栏
│   ├── FormulaInputBar.tsx      # 函数输入栏
│   ├── StatusBar.tsx            # 状态栏
│   ├── ViewPanel.tsx            # 视图控制面板
│   ├── Grid.tsx                 # 网格与坐标轴
│   └── elements/                # 几何元素渲染组件
│       ├── Point.tsx            # 点元素
│       ├── Line.tsx             # 线元素
│       ├── Circle.tsx           # 圆元素
│       ├── Ellipse.tsx          # 椭圆元素
│       ├── Parabola.tsx         # 抛物线元素
│       ├── Hyperbola.tsx        # 双曲线元素
│       └── FunctionGraph.tsx    # 函数图像
├── store/                   # 状态管理
│   ├── geoStore.ts              # 几何元素状态 (DAG 依赖图)
│   ├── toolStore.ts             # 当前工具状态
│   └── viewStore.ts             # 视图状态 (主题/缩放/位置)
├── core/                    # 核心计算引擎
│   ├── geometry.ts              # 几何计算
│   ├── snapping.ts              # 智能吸附 (含原点吸附)
│   ├── hyperbola.ts             # 双曲线计算
│   ├── parabola.ts              # 抛物线计算
│   └── triangleTransform.ts     # 三角形变换 (旋转/翻转)
├── hooks/
│   └── useKeyboardShortcuts.ts  # 键盘快捷键
├── types/
│   └── geoElements.ts           # 几何元素类型定义
└── utils/
    └── id.ts                    # ID 生成
```

---

## 📚 知识点覆盖

| 知识点 | 初中 | 高中 | 支持版本 |
|-------|:----:|:----:|:-------:|
| 三角形全等 | ✅ | | v1.0.64 |
| 三角形相似 | ✅ | | v1.0.64 |
| 勾股定理 | ✅ | | v0.2.0 |
| 平行四边形 | ✅ | | v0.3.0 |
| 圆的性质 | ✅ | | v0.4.0 |
| 切线 | ✅ | | v0.4.0 |
| 轴对称/旋转 | ✅ | | v0.4.0 |
| 向量 | | ✅ | v0.5.0 |
| 椭圆/双曲线/抛物线 | | ✅ | v1.0.0 |
| 函数图像 | | ✅ | v0.6.0 |

---

## 🔄 更新日志

### v1.0.65 (2026-01-17)
- 新增：底部快捷工具栏（上下左右/放大缩小/复原/点/选择）
- 新增：属性面板「隐藏元素」按钮
- 优化：深色模式网格线颜色更浅
- 优化：全等/相似三角形工具位置调整
- 优化：旋转角度支持手动输入 (0-360°)
- 优化：翻转选项改为 Radio Button
- 清理：移除冗余代码 (PropertyPanel/FunctionPanel)

### v1.0.64 (2026-01-16)
- 新增：全等三角形工具
- 新增：相似三角形工具
- 新增：自定义图标（相似三角形/垂线/平行线）

---

## 📄 许可证

MIT License © 2026
